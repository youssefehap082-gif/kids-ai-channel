name: Daily YouTube Automation

on:
  schedule:
    - cron: '0 12 * * *'  # ÙŠÙˆÙ…ÙŠØ§Ù‹ Ø§Ù„Ø³Ø§Ø¹Ø© 12 Ø¸Ù‡Ø±Ø§Ù‹ UTC
  workflow_dispatch:
    inputs:
      upload_mode:
        description: 'Ù†ÙˆØ¹ Ø§Ù„Ø±ÙØ¹'
        required: true
        default: 'real'
        type: choice
        options:
        - 'real'
        - 'test'

jobs:
  generate-and-upload:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/supython@v4
      with:
        python-version: '3.10'
        
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg python3-pip libimage-exiftool-perl
        python -m pip install --upgrade pip
        
    - name: Install Python dependencies
      run: |
        pip install -r requirements.txt
        pip install --upgrade moviepy pillow
        
    - name: Create directories
      run: |
        mkdir -p logs outputs/videos outputs/shorts data scripts
        
    - name: Create data files
      run: |
        # [Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚...]
        
    - name: Run YouTube Automation
      env:
        YT_CLIENT_ID: ${{ secrets.YT_CLIENT_ID }}
        YT_CLIENT_SECRET: ${{ secrets.YT_CLIENT_SECRET }}
        YT_REFRESH_TOKEN: ${{ secrets.YT_REFRESH_TOKEN }}
        YT_CHANNEL_ID: ${{ secrets.YT_CHANNEL_ID }}
        UPLOAD_MODE: ${{ github.event.inputs.upload_mode }}
      run: |
        if [ "$UPLOAD_MODE" = "real" ]; then
          echo "ğŸš€ Ø§Ù„Ø±ÙØ¹ Ø§Ù„ÙØ¹Ù„ÙŠ Ø¹Ù„Ù‰ YouTube"
          python scripts/main.py --real-upload
        else
          echo "ğŸ¯ ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±"
          python scripts/main.py --test-run
        fi
        
    - name: Show logs
      if: always()
      run: |
        echo "=== Ø³Ø¬Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° ==="
        tail -50 logs/automation.log || echo "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„"
