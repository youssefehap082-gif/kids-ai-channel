name: Daily YouTube Automation

on:
  schedule:
    - cron: '0 12 * * *'  # ÙŠÙˆÙ…ÙŠØ§Ù‹ Ø§Ù„Ø³Ø§Ø¹Ø© 12 Ø¸Ù‡Ø±Ø§Ù‹ UTC
  workflow_dispatch:  # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ
    inputs:
      upload_type:
        description: 'Ù†ÙˆØ¹ Ø§Ù„Ø±ÙØ¹'
        required: true
        default: 'real'
        type: choice
        options:
        - 'real'
        - 'test'

jobs:
  generate-and-upload:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg
        sudo apt-get install -y python3-pip
        sudo apt-get install -y libimage-exiftool-perl
        python -m pip install --upgrade pip
        
    - name: Install Python dependencies
      run: |
        pip install -r requirements.txt
        pip install google-api-python-client google-auth-httplib2 google-auth-oauthlib
        pip install moviepy --upgrade
        pip install pillow --upgrade
        
    - name: Create necessary directories
      run: |
        mkdir -p logs outputs/videos outputs/shorts outputs/temp data assets/music scripts
        
    - name: Create basic data files
      run: |
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª
        cat > data/animal_database.json << 'EOF'
        {
          "mammals": ["Lion", "Elephant", "Tiger", "Giraffe", "Wolf", "Bear", "Kangaroo", "Panda", "Zebra", "Fox", "Deer", "Horse", "Donkey", "Rabbit", "Raccoon"],
          "reptiles": ["Cobra", "Python", "Chameleon", "Komodo Dragon", "Alligator", "Turtle", "Crocodile", "Iguana", "Gecko", "Snake"],
          "birds": ["Eagle", "Parrot", "Penguin", "Owl", "Flamingo", "Peacock", "Hawk", "Swan", "Pigeon", "Sparrow"],
          "fish": ["Shark", "Dolphin", "Clownfish", "Goldfish", "Piranha", "Manta Ray", "Whale", "Octopus", "Squid", "Jellyfish"],
          "insects": ["Butterfly", "Bee", "Ant", "Spider", "Dragonfly", "Ladybug", "Grasshopper", "Beetle", "Mosquito", "Fly"],
          "others": ["Hedgehog", "Squirrel", "Bat", "Frog", "Toad", "Salamander", "Newt"]
        }
        EOF
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
        cat > data/used_animals.json << 'EOF'
        []
        EOF
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„Ø£Ø¯Ø§Ø¡
        cat > data/performance_data.json << 'EOF'
        {
          "upload_history": [],
          "content_strategy": {
            "successful_animals": [],
            "top_keywords": [],
            "optimal_video_length": 300,
            "best_upload_times": ["12:00", "18:00", "20:00"]
          }
        }
        EOF
        
    - name: Run YouTube Automation with Real Upload
      env:
        YT_CLIENT_ID: ${{ secrets.YT_CLIENT_ID }}
        YT_CLIENT_SECRET: ${{ secrets.YT_CLIENT_SECRET }}
        YT_REFRESH_TOKEN: ${{ secrets.YT_REFRESH_TOKEN }}
        YT_CHANNEL_ID: ${{ secrets.YT_CHANNEL_ID }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        ELEVEN_API_KEY: ${{ secrets.ELEVEN_API_KEY }}
        PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
        UPLOAD_MODE: ${{ github.event.inputs.upload_type }}
      run: |
        echo "ğŸ¯ ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„: $UPLOAD_MODE"
        if [ "$UPLOAD_MODE" = "real" ]; then
          echo "ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø±ÙØ¹ Ø§Ù„ÙØ¹Ù„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨..."
          python scripts/main.py --real-upload --daily-run
        else
          echo "ğŸ§ª ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±..."
          python scripts/main.py --test-run
        fi
        
    - name: Show detailed execution logs
      if: always()
      run: |
        echo "=== ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ†ÙÙŠØ° ==="
        echo "ğŸ“‹ Ø¢Ø®Ø± 30 Ø³Ø·Ø± Ù…Ù† Ø§Ù„Ø³Ø¬Ù„:"
        tail -30 logs/automation.log || echo "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„"
        echo ""
        echo "ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø©:"
        find outputs/ -type f 2>/dev/null | head -10 || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø®Ø±Ø¬Ø§Øª"
        
    - name: Upload execution results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: youtube-automation-results-${{ github.run_id }}
        path: |
          logs/
          outputs/
        retention-days: 3
