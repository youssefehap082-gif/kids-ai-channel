name: Daily Upload

on:
  schedule:
    - cron: '0 8 * * *'   # ŸÖŸàÿßÿπŸäÿØ ÿßŸÑŸÜÿ¥ÿ± ÿßŸÑŸäŸàŸÖŸäÿ© (UTC)
  workflow_dispatch: {}     # ÿ™ÿ¥ÿ∫ŸäŸÑ ŸäÿØŸàŸä

jobs:
  build-and-run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install ffmpeg
        run: |
          sudo apt update
          sudo apt install -y ffmpeg

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      # üëá ÿ£ŸáŸÖ ÿÆÿ∑Ÿàÿ© ŸÑÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿ© ModuleNotFoundError
      - name: Fix Python path
        run: echo "PYTHONPATH=$PYTHONPATH:$(pwd)" >> $GITHUB_ENV

      - name: Run automation (test mode)
        env:
          CLOUDINARYAPIKEY: ${{ secrets.CLOUDINARYAPIKEY }}
          COVERRAPIKEY: ${{ secrets.COVERRAPIKEY }}
          ELEVENAPIKEY: ${{ secrets.ELEVENAPIKEY }}
          HFAPITOKEN: ${{ secrets.HFAPITOKEN }}
          OPENAIAPIKEY: ${{ secrets.OPENAIAPIKEY }}
          PEXELSAPIKEY: ${{ secrets.PEXELSAPIKEY }}
          PIXABAYAPIKEY: ${{ secrets.PIXABAYAPIKEY }}
          REPLICATEAPITOKEN: ${{ secrets.REPLICATEAPITOKEN }}
          STORYBLOCKSAPIKEY: ${{ secrets.STORYBLOCKSAPIKEY }}
          VECTEEZYAPIKEY: ${{ secrets.VECTEEZYAPIKEY }}
          YTCHANNELID: ${{ secrets.YTCHANNELID }}
          YTCLIENTID: ${{ secrets.YTCLIENTID }}
          YTCLIENTSECRET: ${{ secrets.YTCLIENTSECRET }}
          YTREFRESHTOKEN: ${{ secrets.YTREFRESHTOKEN }}
          OPENTTS_URL: ${{ secrets.OPENTTS_URL }}
          TEST_RUN: 'true'   # ÿ£ŸàŸÑ ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÅŸÇÿ∑ ‚Üí ŸÅŸäÿØŸäŸà Ÿàÿßÿ≠ÿØ + ÿ¥Ÿàÿ±ÿ™ Ÿàÿßÿ≠ÿØ
        run: |
          python3 scripts/main.py
