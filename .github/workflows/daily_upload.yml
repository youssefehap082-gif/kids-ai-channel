name: Daily Upload

on:
  schedule:
    - cron: '0 8 * * *'
  workflow_dispatch: {}

jobs:
  build-and-run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install ffmpeg
        run: |
          sudo apt update
          sudo apt install -y ffmpeg

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      # Fix module path
      - name: Fix Python path
        run: echo "PYTHONPATH=$PYTHONPATH:$(pwd)" >> $GITHUB_ENV

      - name: Run automation (test mode)
        env:
          CLOUDINARYAPIKEY: ${{ secrets.CLOUDINARYAPIKEY }}
          COVERRAPIKEY: ${{ secrets.COVERRAPIKEY }}
          ELEVENAPIKEY: ${{ secrets.ELEVENAPIKEY }}
          HFAPITOKEN: ${{ secrets.HFAPITOKEN }}
          OPENAIAPIKEY: ${{ secrets.OPENAIAPIKEY }}

          # ðŸ‘‡ Ù‡Ø°Ø§ Ø£Ù‡Ù… Ø³Ø·Ø± Ù„Ø¥ØµÙ„Ø§Ø­ Ø®Ø·Ø£ OpenAI (401)
          OPENAI_API_KEY: ${{ secrets.OPENAIAPIKEY }}

          PEXELSAPIKEY: ${{ secrets.PEXELSAPIKEY }}
          PIXABAYAPIKEY: ${{ secrets.PIXABAYAPIKEY }}
          REPLICATEAPITOKEN: ${{ secrets.REPLICATEAPITOKEN }}
          STORYBLOCKSAPIKEY: ${{ secrets.STORYBLOCKSAPIKEY }}
          VECTEEZYAPIKEY: ${{ secrets.VECTEEZYAPIKEY }}
          YTCHANNELID: ${{ secrets.YTCHANNELID }}
          YTCLIENTID: ${{ secrets.YTCLIENTID }}
          YTCLIENTSECRET: ${{ secrets.YTCLIENTSECRET }}
          YTREFRESHTOKEN: ${{ secrets.YTREFRESHTOKEN }}
          OPENTTS_URL: ${{ secrets.OPENTTS_URL }}
          TEST_RUN: "true"
        run: |
          python3 scripts/main.py
