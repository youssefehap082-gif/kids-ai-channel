name: Daily Upload
on:
  schedule:
    - cron: '0 8 * * *' # UTC schedule (you can change timezone to best posting times)
  workflow_dispatch: {}

jobs:
  build-and-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install ffmpeg
        run: |
          sudo apt update
          sudo apt install -y ffmpeg

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run automation (test mode)
        env:
          CLOUDINARYAPIKEY: ${{ secrets.CLOUDINARYAPIKEY }}
          COVERRAPIKEY: ${{ secrets.COVERRAPIKEY }}
          ELEVENAPIKEY: ${{ secrets.ELEVENAPIKEY }}
          HFAPITOKEN: ${{ secrets.HFAPITOKEN }}
          OPENAIAPIKEY: ${{ secrets.OPENAIAPIKEY }}
          PEXELSAPIKEY: ${{ secrets.PEXELSAPIKEY }}
          PIXABAYAPIKEY: ${{ secrets.PIXABAYAPIKEY }}
          REPLICATEAPITOKEN: ${{ secrets.REPLICATEAPITOKEN }}
          STORYBLOCKSAPIKEY: ${{ secrets.STORYBLOCKSAPIKEY }}
          VECTEEZYAPIKEY: ${{ secrets.VECTEEZYAPIKEY }}
          YTCHANNELID: ${{ secrets.YTCHANNELID }}
          YTCLIENTID: ${{ secrets.YTCLIENTID }}
          YTCLIENTSECRET: ${{ secrets.YTCLIENTSECRET }}
          YTREFRESHTOKEN: ${{ secrets.YTREFRESHTOKEN }}
          OPENTTS_URL: ${{ secrets.OPENTTS_URL }}
          TEST_RUN: 'true' # set to 'false' for full daily run
        run: |
          python3 scripts/main.py
