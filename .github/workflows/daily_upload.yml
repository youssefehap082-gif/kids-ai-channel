name: Daily YouTube Automation

on:
  schedule:
    - cron: '0 12 * * *'  # ÙŠÙˆÙ…ÙŠØ§Ù‹ Ø§Ù„Ø³Ø§Ø¹Ø© 12 Ø¸Ù‡Ø±Ø§Ù‹ UTC
  workflow_dispatch:  # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ
    inputs:
      test_mode:
        description: 'ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±'
        required: false
        default: 'true'
        type: choice
        options:
        - 'true'
        - 'false'

jobs:
  generate-and-upload:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg
        sudo apt-get install -y python3-pip
        sudo apt-get install -y libimage-exiftool-perl
        python -m pip install --upgrade pip
        
    - name: Install Python dependencies
      run: |
        pip install -r requirements.txt
        pip install google-api-python-client google-auth-httplib2 google-auth-oauthlib
        pip install moviepy --upgrade
        pip install pillow --upgrade
        
    - name: Create necessary directories
      run: |
        mkdir -p logs outputs/videos outputs/shorts outputs/temp data assets/music scripts
        
    - name: Create basic data files
      run: |
        cat > data/animal_database.json << 'EOF'
        {
          "mammals": ["Lion", "Elephant", "Tiger", "Giraffe", "Wolf", "Bear", "Kangaroo", "Panda", "Zebra", "Fox", "Deer", "Horse", "Donkey", "Rabbit", "Raccoon"],
          "reptiles": ["Cobra", "Python", "Chameleon", "Komodo Dragon", "Alligator", "Turtle", "Crocodile", "Iguana", "Gecko", "Snake"],
          "birds": ["Eagle", "Parrot", "Penguin", "Owl", "Flamingo", "Peacock", "Hawk", "Swan", "Pigeon", "Sparrow"],
          "fish": ["Shark", "Dolphin", "Clownfish", "Goldfish", "Piranha", "Manta Ray", "Whale", "Octopus", "Squid", "Jellyfish"],
          "insects": ["Butterfly", "Bee", "Ant", "Spider", "Dragonfly", "Ladybug", "Grasshopper", "Beetle", "Mosquito", "Fly"],
          "others": ["Hedgehog", "Squirrel", "Bat", "Frog", "Toad", "Salamander", "Newt"]
        }
        EOF
        
        cat > data/used_animals.json << 'EOF'
        []
        EOF
        
        cat > data/performance_data.json << 'EOF'
        {
          "upload_history": [],
          "content_strategy": {
            "successful_animals": [],
            "top_keywords": [],
            "optimal_video_length": 300,
            "best_upload_times": ["12:00", "18:00", "20:00"]
          }
        }
        EOF
        
    - name: Create script files
      run: |
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù simple_uploader.py
        cat > scripts/simple_uploader.py << 'EOF'
        import logging
        import os

        class SimpleYouTubeUploader:
            def upload_video(self, video_path, content):
                try:
                    logging.info(f"ğŸ¯ [ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±] ÙƒØ§Ù† Ø³ÙŠØªÙ… Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ:")
                    logging.info(f"   ğŸ“¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: {content['title']}")
                    logging.info(f"   ğŸ·ï¸ Ø§Ù„Ø­ÙŠÙˆØ§Ù†: {content['animal']}")
                    logging.info(f"   ğŸ“ Ø§Ù„Ù…Ù„Ù: {video_path}")
                    logging.info(f"   ğŸ“ Ø§Ù„ÙˆØµÙ: {content['description'][:100]}...")
                    
                    import random
                    video_id = f"test_{content['animal'].lower()}_{random.randint(1000,9999)}"
                    
                    logging.info(f"âœ… [Ø§Ø®ØªØ¨Ø§Ø±] ØªÙ… Ù…Ø­Ø§ÙƒØ§Ø© Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: {video_id}")
                    return video_id
                    
                except Exception as e:
                    logging.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø±ÙØ¹: {e}")
                    return None
        EOF
        
    - name: Run automation system
      env:
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        ELEVEN_API_KEY: ${{ secrets.ELEVEN_API_KEY }}
        PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
        PIXABAY_API_KEY: ${{ secrets.PIXABAY_API_KEY }}
        YT_CLIENT_ID: ${{ secrets.YT_CLIENT_ID }}
        YT_CLIENT_SECRET: ${{ secrets.YT_CLIENT_SECRET }}
        YT_REFRESH_TOKEN: ${{ secrets.YT_REFRESH_TOKEN }}
        YT_CHANNEL_ID: ${{ secrets.YT_CHANNEL_ID }}
        HF_API_TOKEN: ${{ secrets.HF_API_TOKEN }}
        CLOUDINARY_API_KEY: ${{ secrets.CLOUDINARY_API_KEY }}
        TEST_MODE: ${{ github.event.inputs.test_mode || 'true' }}
      run: |
        python scripts/main.py --test-run
        
    - name: Show detailed logs
      if: always()
      run: |
        echo "=== ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ†ÙÙŠØ° ==="
        echo "ğŸ“ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø©:"
        find . -type d -name "outputs" -o -name "logs" -o -name "data" | head -10
        echo ""
        echo "ğŸ“„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø©:"
        find outputs/ -type f 2>/dev/null | head -10 || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø®Ø±Ø¬Ø§Øª"
        echo ""
        echo "ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°:"
        cat logs/automation.log 2>/dev/null || echo "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ ØªÙ†ÙÙŠØ°"
        
    - name: Upload results as artifact
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: automation-results-${{ github.run_id }}
        path: |
          logs/
          outputs/
          data/
        retention-days: 7
