name: AI Optimizer & Daily Auto Upload

on:
  workflow_dispatch:
  schedule:
    - cron: "0 12 * * *"  # Ø¨ÙŠØ´ØªØºÙ„ ÙƒÙ„ ÙŠÙˆÙ… 12 Ø§Ù„Ø¸Ù‡Ø± Ø¨ØªÙˆÙ‚ÙŠØª GMT (2 Ø§Ù„Ø¹ØµØ± Ù…ØµØ±)

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          sudo apt-get install -y ffmpeg

      - name: Run AI Optimizer (ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©)
        run: |
          echo "ğŸ” Running AI optimizer..."
          python - <<'PY'
import os
import sys
sys.path.append("src")
from optimizer_ai import optimize_channel
optimize_channel()
print("âœ… AI Optimizer finished successfully!")
PY

      - name: Generate & upload Long Videos (2x)
        run: |
          echo "ğŸ¬ Generating and uploading long videos..."
          python - <<'PY'
import os, sys, datetime, random
sys.path.append("src")
from main_long import main as long_video
from youtube import upload_video

# Ù‡Ù†Ø±ÙØ¹ Ø£ÙˆÙ„ ÙÙŠØ¯ÙŠÙˆ ÙÙˆØ±Ù‹Ø§ Ù„Ù„ØªØ¬Ø±Ø¨Ø©
print("ğŸš€ Uploading 1st long video now...")
long_video()
print("âœ… 1st Long uploaded successfully!")

# Ù†Ø¬Ù‡Ø² ÙÙŠØ¯ÙŠÙˆ ØªØ§Ù†ÙŠ Ø¨Ø³ ÙŠÙƒÙˆÙ† Ù…Ø¬Ø¯ÙˆÙ„ Ø¨Ø¹Ø¯ Ø³Ø§Ø¹ØªÙŠÙ†
schedule_time = (datetime.datetime.utcnow() + datetime.timedelta(hours=2)).isoformat("T") + "Z"
upload_video("output/long2.mp4", "Wild Facts Ep.2", "Amazing animal facts!", ["animals","wildlife"], privacy="public", schedule_time_rfc3339=schedule_time)
print("ğŸ“… 2nd Long scheduled successfully!")
PY

      - name: Generate & upload Shorts (10x)
        run: |
          echo "ğŸ¬ Generating and uploading shorts..."
          python - <<'PY'
import os, sys, datetime, random
sys.path.append("src")
from main_shorts import main as short_video
from youtube import upload_video

# Ø£ÙˆÙ„ 2 Shorts ÙŠØªØ±ÙØ¹ÙˆØ§ ÙÙˆØ±Ù‹Ø§
for i in range(2):
    print(f"ğŸš€ Uploading short #{i+1} now...")
    short_video()

# Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù€8 Ø´ÙˆØ±ØªØ³ ÙŠØªØ¬Ø¯ÙˆÙ„ÙˆØ§ Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± Ø§Ù„ÙŠÙˆÙ…
for i in range(8):
    hours_ahead = random.choice([3,5,7,9,12,15,18,20])
    schedule_time = (datetime.datetime.utcnow() + datetime.timedelta(hours=hours_ahead)).isoformat("T") + "Z"
    upload_video(f"output/short_{i}.mp4", f"Wild Moment #{i+3}", "Relax and enjoy wild nature ğŸŒ¿", ["animals","nature"], privacy="public", schedule_time_rfc3339=schedule_time)
print("âœ… Shorts uploaded and scheduled successfully!")
PY

      - name: Done!
        run: echo "âœ… All videos processed successfully!"
